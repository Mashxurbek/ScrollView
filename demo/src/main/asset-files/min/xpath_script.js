var XPath=function(a,b){this.reader=new XPath.Reader(a,b);this.writer=new XPath.Writer(a,b)};XPath.prototype={reader:null,writer:null,read:function(a){return this.reader.read(a)},write:function(a){return this.writer.write(a)}};XPath.XPATH_DELIMITER="/";XPath.XPATH_INDEX_OPEN="[";XPath.XPATH_INDEX_CLOSE="]";XPath.Reader=function(a,b){this.root=a;this.prohibited=b};
XPath.Reader.prototype={prohibited:null,root:null,read:function(a,b){if(!a)return null;if(a==XPath.XPATH_DELIMITER)return this.root;a.charAt(0)==XPath.XPATH_DELIMITER&&(a=a.substring(1));a=a.toUpperCase();b=b||this.root;var e=a.split(XPath.XPATH_DELIMITER),c=e.shift(),d,f=c.indexOf(XPath.XPATH_INDEX_OPEN);if(-1<f){var g=c.indexOf(XPath.XPATH_INDEX_CLOSE);d=c.substring(0,f);c=c.substring(f+1,g)}else d=c,c=1;d=this.getChildOfTypeAt(b,d,c);return 0==e.length?d:this.read(e.join(XPath.XPATH_DELIMITER),
d)},getChildOfTypeAt:function(a,b,e){b=b.toUpperCase();for(var c=[],d=0;d<a.children.length;d++)c[d]=a.children[d];for(d=0;d<c.length;d++)if(a=c[d],a.nodeName.toUpperCase()==b)if(Dom.matches(a,this.prohibited)){a=this.flattenChildren(a);for(var f=0;f<a.length;f++)c.splice(d+f,1,a[f])}else if(0>=--e)return a;return null},flattenChildren:function(a,b){b=b||[];for(var e=0;e<a.children.length;e++){var c=a.children[e];Dom.matches(c,this.prohibited)?this.flattenChildren(c,b):b.push(c)}return b}};
XPath.Writer=function(a,b){this.root=a;this.prohibited=b};XPath.Writer.prototype={prohibited:null,root:null,write:function(a){a.nodeType!=Node.ELEMENT_NODE&&(a=a.parentElement);for(var b=[],e=new XPath.Writer.Component(this.root,this.prohibited);null!=a&&a!=this.root;){e.walk(a);b.unshift(e.getString());var c=e.getParent();if(c==this.root||null==a)break;a=c}return XPath.XPATH_DELIMITER+b.join(XPath.XPATH_DELIMITER).toUpperCase()}};XPath.Writer.Component=function(a,b){this.root=a;this.prohibited=b};
XPath.Writer.Component.STARTING_INDEX=1;
XPath.Writer.Component.prototype={position:XPath.Writer.Component.STARTING_INDEX,tag:null,prohibited:null,root:null,getString:function(){return this.tag+XPath.XPATH_INDEX_OPEN+this.position+XPath.XPATH_INDEX_CLOSE},getParent:function(){return this.element.parentElement},getPrevious:function(){return this.element.previousElementSibling},increment:function(){this.position++},moveBack:function(){this.element=this.getPrevious()},moveUp:function(){this.element=this.getParent()},setElementToFirstNonProhibited:function(){for(;Dom.matches(this.element,
this.prohibited);)this.moveUp()},count:function(){for(;null!=this.getPrevious();)this.getPrevious().nodeName==this.tag&&(Dom.matches(this.getPrevious(),this.prohibited)||this.increment()),this.moveBack()},walk:function(a){this.position=XPath.Writer.Component.STARTING_INDEX;this.element=a;this.tag=this.element.nodeName;this.setElementToFirstNonProhibited();for(this.count();Dom.matches(this.getParent(),this.prohibited);)this.moveUp(),this.count()}};