(function(){var f={},c=new Annotator({tagName:"span",className:"annotator-highlight",noteClassName:"annotator-note",leadClassName:"annotator-note-first",rootNode:document.getElementById("sbo-rt-content"),blacklist:Oreilly.configuration.blacklist}),h=function(){};c.addValidationHook(function(a){if(a.quote.length>Annotator.MAXIMUM_HIGHLIGHT_LENGTH||a.exception==Annotator.HIGHLIGHT_MAXIMUM_LENGTH_EXCEEDED_MESSAGE)throw new h;});c.addValidationHook(function(a){if(null==a.quote)throw Error();});c.addValidationHook(function(a){if(null!=
a.text&&a.text.length>Annotator.MAXIMUM_HIGHLIGHT_LENGTH)throw Error();});c.setValidationHandler(function(a){a instanceof h&&(window.AnnotationsInterface.onAnnotationTooLargeToSave(),window.getSelection().removeAllRanges())});c.start();var g={pattern:/[xy]/g,placeholder:"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx",replacer:function(a){var b=16*Math.random()|0;return("x"==a?b:b&3|8).toString(16)},get:function(){return g.placeholder.replace(g.pattern,g.replacer)}},e={draw:function(a){var b=a.ranges[0];try{c.highlightRange(b,
!!a.text).forEach(function(b){b.annotation=a;b.classList.add("highlight-for-annotation-"+a.identifier)})}catch(d){console.log(d),console.log(d.stack),console.log(JSON.stringify(a))}},clear:function(a){for(a=c.options.rootNode.getElementsByClassName("highlight-for-annotation-"+a.identifier);0<a.length;)c.highlighter.clearHighlight(a[0])},redraw:function(a){e.clear(a);e.draw(a)}};window.JavaScriptBridge={addSelectedAnnotation:function(a){c.validate();if(c.isValid){var b;b=c.selection;var d=g.get();
b={quote:b.quote,fragment:b.fragment,text:b.text,id:d,identifier:d,ranges:[c.getRangeDescriptorFromSelection()]};b=JSON.stringify(b);a?window.AnnotationsInterface.processAnnotationForNote(b):window.JavaScriptBridge.createAnnotation(b)}},createAnnotation:function(a){var b=JSON.parse(a);f[b.identifier]=b;window.AnnotationsInterface.onAnnotationCreated(a);window.getSelection().removeAllRanges();e.draw(b)},updateAnnotation:function(a){a=JSON.parse(a);var b=a.text;if(a=f[a.identifier])a.text=b,e.redraw(a)},
deleteAnnotation:function(a){a=JSON.parse(a);console.log("deleteAnnotation called on "+a.identifier);if(a=f[a.identifier])e.clear(a),delete f[a.identifier]},loadAnnotations:function(a){c.clear();(a=JSON.parse(a))&&a.forEach(function(a){f[a.identifier]=a;try{e.draw(a)}catch(c){}})}};document.body.addEventListener("click",function(a){if(a.target.classList.contains(c.options.className)){var b=Oreilly.getAnnotationsAsJson(a.target),d=Oreilly.getContainer(a.target,["A"]);if(null==d)window.AnnotationsInterface.startEditingExistingAnnotations(b);
else return window.AnnotationsInterface.onHighlightConflictDetected(d.href,b),a.preventDefault(),a.stopPropagation(),a.stopImmediatePropagation(),!1}})})();