var Highlighter=function(a){this.options=a||{};this.xpath=new XPath(this.options.rootNode,this.options.blacklist)};Highlighter.IS_ONLY_WHITESPACE_REGEX=/^\s*$/;Highlighter.PROHIBITED_PARENT_TAGS="ul ol option select table tbody thead tr textarea".split(" ");
Highlighter.prototype={options:null,xpath:null,shouldHighlightNode:function(a){return null!=a&&a.nodeType==Node.TEXT_NODE&&null!=a.parentNode&&-1==Highlighter.PROHIBITED_PARENT_TAGS.indexOf(a.parentNode.nodeName)&&!Highlighter.IS_ONLY_WHITESPACE_REGEX.test(a.wholeText+a.nodeValue)},highlightNode:function(a,b){if(!this.shouldHighlightNode(a))return null;var c=document.createElement(this.options.tagName);c.appendChild(document.createTextNode(a.nodeValue));c.classList.add(this.options.className);b&&
c.classList.add(this.options.className+"-"+b);a.parentNode.replaceChild(c,a);return c},clearHighlight:function(a){for(;0<a.childNodes.length;)a.parentElement.insertBefore(a.firstChild,a);a.parentElement.removeChild(a)},clearAll:function(){for(var a=this.options.rootNode.querySelectorAll(this.options.tagName+"."+this.options.className),b=0;b<a.length;b++)this.clearHighlight(a[b])},clearRange:function(a){a=this.options.rootNode.querySelectorAll(this.options.tagName+"."+this.options.className+"-"+a);
for(var b=0;b<a.length;b++)this.clearHighlight(a[b])},highlightRange:function(a,b){var c=this.xpath.read(a.start);0<a.startOffset&&(c=Dom.getNodeAndOffset(c,a.startOffset),c=c.node.splitText(c.offset));var d=this.xpath.read(a.end);0<a.endOffset&&(d=Dom.getNodeAndOffset(d,a.endOffset),d=d.node.splitText(d.offset).previousSibling);var e=[];Dom.getTextNodesBetween(c,d).forEach(function(a){a=this.highlightNode(a,b);if(null==a)return!0;e.push(a)},this);return e}};